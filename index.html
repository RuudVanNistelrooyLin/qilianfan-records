<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ä¸ƒè¿ç¿»è®¡åˆ†æ¿</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      padding: 20px;
      background-color: #f7f7f7;
      color: #333;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin-top: 10px;
    }

    /* æ¨ªå±æ—¶æ˜¾ç¤ºè¡¨æ ¼ */
    #landscape-mode {
      display: none;
      width: 100%;
    }

    #landscape-mode.active {
      display: flex;
      flex-direction: column;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background-color: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      flex: 1;
    }

    th, td {
      padding: 12px 8px;
      text-align: center;
    }

    th {
      background-color: #4CAF50;
      color: white;
      font-weight: bold;
    }

    td input {
      width: 90%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      text-align: center;
      font-size: 16px;
    }

    .player-name {
      font-weight: bold;
      background-color: #f0f5f0;
    }

    .total-row {
      background-color: #e8f5e8;
      font-weight: bold;
    }

    .add-row-btn {
      margin: 16px auto;
      padding: 12px 24px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      width: 80%;
    }

    .add-player {
      width: 90%;
      padding: 10px;
      margin: 8px 0;
      border: 1px dashed #4CAF50;
      text-align: center;
      color: #4CAF50;
      background: none;
      cursor: pointer;
      font-size: 16px;
    }

    /* ç«–å±æç¤º */
    #portrait-tip {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      height: 100vh;
      background-color: #f7f7f7;
      color: #555;
      padding: 20px;
      box-sizing: border-box;
    }

    #portrait-tip img {
      width: 120px;
      height: 120px;
      margin-bottom: 20px;
      opacity: 0.7;
    }

    #portrait-tip h2 {
      color: #d32f2f;
      margin-bottom: 10px;
    }

    #portrait-tip p {
      font-size: 18px;
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <!-- æ¨ªå±æ¨¡å¼ï¼šè®¡åˆ†æ¿ -->
  <div id="landscape-mode">
    <h1>ğŸ² ä¸ƒè¿ç¿»è®¡åˆ†æ¿</h1>
    <table id="scoreTable">
      <thead>
        <tr id="headerRow"></tr>
      </thead>
      <tbody id="scoreBody"></tbody>
    </table>
    <button class="add-row-btn" onclick="addScoreRow()">+ æ–°å¢ä¸€å±€</button>
  </div>

  <!-- ç«–å±æ¨¡å¼ï¼šæç¤ºæ—‹è½¬ -->
  <div id="portrait-tip">
    <img src="https://cdn-icons-png.flaticon.com/512/184/184993.png" alt="è¯·æ—‹è½¬æ‰‹æœº" />
    <h2>è¯·æ—‹è½¬æ‰‹æœº</h2>
    <p>ä¸ºäº†æ›´å¥½çš„ä½“éªŒï¼Œè¯·å°†æ‰‹æœºæ¨ªå±ä½¿ç”¨æœ¬è®¡åˆ†æ¿ã€‚</p>
    <p>æ¨ªå‘å±å¹•å¯æ˜¾ç¤ºæ›´å¤šç©å®¶å’Œåˆ†æ•°ï¼Œæ–¹ä¾¿å¤šäººæ¸¸æˆï¼</p>
  </div>

  <script>
    const STORAGE_KEY = 'qilianfan_scores_v2';
    let gameData = {
      players: ['ç©å®¶1', 'ç©å®¶2'],
      scores: []
    };

    function loadFromStorage() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          const parsed = JSON.parse(saved);
          if (parsed.players && Array.isArray(parsed.players) && parsed.scores && Array.isArray(parsed.scores)) {
            gameData = parsed;
          }
        } catch (e) {
          console.warn('Failed to parse saved data', e);
        }
      }
    }

    function saveToStorage() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(gameData));
    }

    function renderHeader() {
      const headerRow = document.getElementById('headerRow');
      headerRow.innerHTML = '<th>å±€æ•°</th>';
      gameData.players.forEach((name, index) => {
        const th = document.createElement('th');
        const input = document.createElement('input');
        input.type = 'text';
        input.value = name;
        input.className = 'player-name';
        input.dataset.index = index;
        input.addEventListener('change', function() {
          gameData.players[index] = this.value.trim() || `ç©å®¶${index + 1}`;
          saveToStorage();
          render();
        });
        th.appendChild(input);
        headerRow.appendChild(th);
      });
    }

    function renderScoreRows() {
      const tbody = document.getElementById('scoreBody');
      tbody.innerHTML = '';

      // æ¸²æŸ“æ¯ä¸€å±€
      gameData.scores.forEach((row, rowIndex) => {
        const tr = document.createElement('tr');
        const roundTd = document.createElement('td');
        roundTd.textContent = `ç¬¬${rowIndex + 1}å±€`;
        tr.appendChild(roundTd);

        gameData.players.forEach((player, playerIndex) => {
          const td = document.createElement('td');
          const input = document.createElement('input');
          input.type = 'number';
          input.inputMode = 'numeric'; // å¼¹å‡ºæ•°å­—é”®ç›˜
          input.value = row[playerIndex] !== undefined ? row[playerIndex] : '';
          input.dataset.row = rowIndex;
          input.dataset.col = playerIndex;
          input.addEventListener('change', function() {
            const rowIdx = parseInt(this.dataset.row);
            const colIdx = parseInt(this.dataset.col);
            const value = this.value.trim();
            gameData.scores[rowIdx][colIdx] = value ? parseInt(value) || 0 : 0;
            saveToStorage();
            updateTotalRow();
          });
          td.appendChild(input);
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });

      // æ·»åŠ ç©å®¶æŒ‰é’®è¡Œ
      const addPlayerTr = document.createElement('tr');
      const addPlayerTd = document.createElement('td');
      addPlayerTd.colSpan = gameData.players.length + 1;
      const addPlayerBtn = document.createElement('button');
      addPlayerBtn.textContent = '+ æ·»åŠ ç©å®¶';
      addPlayerBtn.className = 'add-player';
      addPlayerBtn.onclick = addPlayer;
      addPlayerTd.appendChild(addPlayerBtn);
      addPlayerTr.appendChild(addPlayerTd);
      tbody.appendChild(addPlayerTr);

      // æ¸²æŸ“æ€»åˆ†è¡Œ
      renderTotalRow();
    }

    function renderTotalRow() {
      const tbody = document.getElementById('scoreBody');
      const totalTr = document.createElement('tr');
      totalTr.className = 'total-row';

      const totalTd = document.createElement('td');
      totalTd.textContent = 'æ€»åˆ†';
      totalTr.appendChild(totalTd);

      gameData.players.forEach((player, playerIndex) => {
        const td = document.createElement('td');
        const total = gameData.scores.reduce((sum, row) => {
          const score = row[playerIndex];
          return sum + (score !== undefined ? score : 0);
        }, 0);
        td.textContent = total;
        totalTr.appendChild(td);
      });

      tbody.appendChild(totalTr);
    }

    function updateTotalRow() {
      const rows = document.getElementById('scoreBody').children;
      const totalTr = rows[rows.length - 1];
      gameData.players.forEach((player, playerIndex) => {
        const total = gameData.scores.reduce((sum, row) => {
          const score = row[playerIndex];
          return sum + (score !== undefined ? score : 0);
        }, 0);
        totalTr.children[playerIndex + 1].textContent = total;
      });
    }

    function addScoreRow() {
      const newRow = new Array(gameData.players.length).fill('');
      gameData.scores.push(newRow);
      saveToStorage();
      render();
    }

    function addPlayer() {
      const newPlayerName = `ç©å®¶${gameData.players.length + 1}`;
      gameData.players.push(newPlayerName);
      gameData.scores.forEach(row => row.push(''));
      saveToStorage();
      render();
    }

    function render() {
      renderHeader();
      renderScoreRows();
    }

    // æ£€æµ‹æ–¹å‘
    function checkOrientation() {
      const isLandscape = window.innerWidth > window.innerHeight;
      document.getElementById('landscape-mode').classList.toggle('active', isLandscape);
      document.getElementById('portrait-tip').style.display = isLandscape ? 'none' : 'flex';
    }

    window.addEventListener('load', () => {
      loadFromStorage();
      checkOrientation(); // åˆå§‹åŒ–æ£€æµ‹
      render();
      if (gameData.scores.length === 0) {
        addScoreRow();
      }
    });

    // ç›‘å¬æ–¹å‘å˜åŒ–
    window.addEventListener('orientationchange', () => {
      setTimeout(checkOrientation, 300); // å»¶è¿Ÿç¡®ä¿å°ºå¯¸å·²æ›´æ–°
    });
    window.addEventListener('resize', checkOrientation);
  </script>
</body>
</html>