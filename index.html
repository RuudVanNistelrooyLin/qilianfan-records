<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="description" content="ä¸ƒè¿ç¿»è®¡åˆ†æ¿ - æ”¯æŒæ¨ªç«–å±ï¼Œå«åˆ é™¤ç©å®¶åŠŸèƒ½">
  <title>ä¸ƒè¿ç¿»è®¡åˆ†æ¿</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #f7f7f7;
      color: #333;
      min-height: 100vh;
      padding: 8px;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin: 0 0 12px;
      font-size: 1.5em;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(0,0,0,0.1);
      margin-bottom: 12px;
    }

    th, td {
      padding: 10px 6px;
      text-align: center;
    }

    th {
      background-color: #4CAF50;
      color: white;
      font-weight: bold;
    }

    td input {
      width: 85%;
      padding: 6px;
      border: 1px solid #ddd;
      border-radius: 6px;
      text-align: center;
      font-size: 15px;
    }

    .player-name {
      font-weight: bold;
      background-color: #f0f5f0;
    }

    .total-row {
      background-color: #e8f5e8;
      font-weight: bold;
    }

    .action-btn {
      display: block;
      width: 90%;
      max-width: 300px;
      margin: 8px auto;
      padding: 12px 0;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      text-align: center;
    }

    .add-row-btn {
      background-color: #4CAF50;
      color: white;
    }

    .reset-btn {
      background-color: #d32f2f;
      color: white;
    }

    .add-player-btn {
      background-color: #2196F3;
      color: white;
    }

    .delete-player-btn {
      background-color: #9c27b0;
      color: white;
    }

    /* ========== ç«–å±æç¤º ========== */
    #portrait-tip {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
      background-color: #fff8e1;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      margin: 10px auto;
      max-width: 400px;
    }

    #portrait-tip img {
      width: 80px;
      height: 80px;
      opacity: 0.8;
      margin-bottom: 12px;
    }

    #portrait-tip h2 {
      color: #d32f2f;
      margin-bottom: 8px;
      font-size: 1.3em;
    }

    #portrait-tip p {
      font-size: 15px;
      color: #555;
      line-height: 1.5;
    }

    #portrait-tip button {
      margin-top: 12px;
      padding: 8px 16px;
      background: #757575;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- ç«–å±æç¤º -->
  <div id="portrait-tip">
    <img src="https://cdn-icons-png.flaticon.com/512/184/184993.png" alt="è¯·æ—‹è½¬æ‰‹æœº">
    <h2>å»ºè®®æ¨ªå±ä½¿ç”¨</h2>
    <p>æ¨ªå±ä½“éªŒæ›´ä½³ï¼Œè¡¨æ ¼æ›´æ¸…æ™°<br>ä¹Ÿå¯ç»§ç»­ä½¿ç”¨ç«–å±æ¨¡å¼</p>
    <button onclick="this.parentElement.remove()">ç»§ç»­ä½¿ç”¨ç«–å±</button>
  </div>

  <!-- ä¸»å†…å®¹ -->
  <h1>ğŸ² ä¸ƒè¿ç¿»è®¡åˆ†æ¿</h1>
  <table id="scoreTable">
    <thead>
      <tr id="headerRow"></tr>
    </thead>
    <tbody id="scoreBody"></tbody>
  </table>

  <button class="action-btn add-row-btn" onclick="addScoreRow()">+ æ–°å¢ä¸€å±€</button>
  <button class="action-btn reset-btn" onclick="resetScores()">ğŸ” æ¸…ç©ºåˆ†æ•°ï¼Œä¿ç•™ç©å®¶</button>
  <button class="action-btn add-player-btn" onclick="addPlayer()">+ æ·»åŠ ç©å®¶</button>
  <button class="action-btn delete-player-btn" onclick="deleteLastPlayer()">âŒ åˆ é™¤æœ€åä¸€ä½ç©å®¶</button>

  <script>
    const STORAGE_KEY = 'qilianfan_scores_v3';
    let gameData = {
      players: ['ç©å®¶1', 'ç©å®¶2'],
      scores: []
    };

    function loadFromStorage() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          const parsed = JSON.parse(saved);
          if (parsed.players && Array.isArray(parsed.players) && parsed.scores && Array.isArray(parsed.scores)) {
            gameData = parsed;
          }
        } catch (e) {
          console.warn('è§£æå¤±è´¥', e);
        }
      }
    }

    function saveToStorage() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(gameData));
    }

    function renderHeader() {
      const headerRow = document.getElementById('headerRow');
      headerRow.innerHTML = '<th>å±€æ•°</th>';
      gameData.players.forEach((name, index) => {
        const th = document.createElement('th');
        const input = document.createElement('input');
        input.type = 'text';
        input.value = name;
        input.className = 'player-name';
        input.dataset.index = index;
        input.addEventListener('change', function() {
          gameData.players[index] = this.value.trim() || `ç©å®¶${index + 1}`;
          saveToStorage();
          render();
        });
        th.appendChild(input);
        headerRow.appendChild(th);
      });
    }

    function renderScoreRows() {
      const tbody = document.getElementById('scoreBody');
      tbody.innerHTML = '';

      gameData.scores.forEach((row, rowIndex) => {
        const tr = document.createElement('tr');
        const roundTd = document.createElement('td');
        roundTd.textContent = `ç¬¬${rowIndex + 1}å±€`;
        tr.appendChild(roundTd);

        gameData.players.forEach((player, playerIndex) => {
          const td = document.createElement('td');
          const input = document.createElement('input');
          input.type = 'number';
          input.inputMode = 'numeric';
          input.value = row[playerIndex] !== undefined ? row[playerIndex] : '';
          input.dataset.row = rowIndex;
          input.dataset.col = playerIndex;
          input.addEventListener('change', function() {
            const rowIdx = parseInt(this.dataset.row);
            const colIdx = parseInt(this.dataset.col);
            const value = this.value.trim();
            gameData.scores[rowIdx][colIdx] = value ? parseInt(value) || 0 : 0;
            saveToStorage();
            updateTotalRow();
          });
          td.appendChild(input);
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });

      renderTotalRow();
    }

    function renderTotalRow() {
      const tbody = document.getElementById('scoreBody');
      const totalTr = document.createElement('tr');
      totalTr.className = 'total-row';

      const totalTd = document.createElement('td');
      totalTd.textContent = 'æ€»åˆ†';
      totalTr.appendChild(totalTd);

      gameData.players.forEach((player, playerIndex) => {
        const td = document.createElement('td');
        const total = gameData.scores.reduce((sum, row) => {
          const score = row[playerIndex];
          return sum + (score !== undefined ? score : 0);
        }, 0);
        td.textContent = total;
        totalTr.appendChild(td);
      });

      tbody.appendChild(totalTr);
    }

    function updateTotalRow() {
      const rows = document.getElementById('scoreBody').children;
      const totalTr = rows[rows.length - 1];
      gameData.players.forEach((player, playerIndex) => {
        const total = gameData.scores.reduce((sum, row) => {
          const score = row[playerIndex];
          return sum + (score !== undefined ? score : 0);
        }, 0);
        totalTr.children[playerIndex + 1].textContent = total;
      });
    }

    function addScoreRow() {
      const newRow = new Array(gameData.players.length).fill('');
      gameData.scores.push(newRow);
      saveToStorage();
      render();
    }

    function addPlayer() {
      const newPlayerName = `ç©å®¶${gameData.players.length + 1}`;
      gameData.players.push(newPlayerName);
      gameData.scores.forEach(row => row.push(''));
      saveToStorage();
      render();
    }

    // ğŸ”´ æ–°å¢ï¼šåˆ é™¤æœ€åä¸€ä½ç©å®¶
    function deleteLastPlayer() {
      if (gameData.players.length <= 2) {
        alert('è‡³å°‘ä¿ç•™ 2 ä½ç©å®¶å“¦ï½');
        return;
      }

      if (confirm(`âš ï¸ ç¡®å®šè¦åˆ é™¤æœ€åä¸€ä½ç©å®¶ã€Œ${gameData.players[gameData.players.length - 1]}ã€å—ï¼Ÿ`)) {
        gameData.players.pop(); // åˆ é™¤ç©å®¶
        gameData.scores.forEach(row => row.pop()); // åˆ é™¤å¯¹åº”åˆ†æ•°
        saveToStorage();
        render();
      }
    }

    function resetScores() {
      if (confirm('âš ï¸ ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰åˆ†æ•°å’Œå±€æ•°å—ï¼Ÿ\nç©å®¶å§“åå°†ä¿ç•™')) {
        gameData.scores = [];
        saveToStorage();
        addScoreRow();
        render();
      }
    }

    function render() {
      renderHeader();
      renderScoreRows();
    }

    // åˆå§‹åŒ–
    window.addEventListener('load', () => {
      loadFromStorage();
      render();
      if (gameData.scores.length === 0) {
        addScoreRow();
      }

      // 3ç§’åè‡ªåŠ¨éšè—æç¤º
      setTimeout(() => {
        const tip = document.getElementById('portrait-tip');
        if (tip) {
          tip.style.opacity = '0';
          tip.style.transition = 'opacity 0.5s';
          setTimeout(() => tip.remove(), 500);
        }
      }, 3000);
    });
  </script>
</body>
</html>