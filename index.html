<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="description" content="ä¸ƒè¿ç¿»è®¡åˆ†æ¿ - æ¨ªå±ä½¿ç”¨ï¼ŒæŒ‰é’®å¸ƒå±€ä¼˜åŒ–">
  <title>ä¸ƒè¿ç¿»è®¡åˆ†æ¿</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #f7f7f7;
      color: #333;
      height: 100vh;
      overflow: hidden;
    }

    /* ========== æ¨ªå±æ¨¡å¼ ========== */
    #landscape-mode {
      display: none;
      flex-direction: column;
      width: 100%;
      height: 100%;
      padding: 10px;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin: 0 0 10px;
      font-size: 1.4em;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(0,0,0,0.1);
      flex: 1;
    }

    th, td {
      padding: 10px 6px;
      text-align: center;
    }

    th {
      background-color: #4CAF50;
      color: white;
      font-weight: bold;
    }

    td input {
      width: 85%;
      padding: 6px;
      border: 1px solid #ddd;
      border-radius: 6px;
      text-align: center;
      font-size: 15px;
    }

    .player-name {
      font-weight: bold;
      background-color: #f0f5f0;
    }

    .total-row {
      background-color: #e8f5e8;
      font-weight: bold;
    }

    .action-btn {
      margin: 8px auto;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      width: 80%;
      font-weight: bold;
    }

    .add-row-btn {
      background-color: #4CAF50;
      color: white;
    }

    .reset-btn {
      background-color: #d32f2f;
      color: white;
    }

    .add-player-btn {
      background-color: #2196F3;
      color: white;
    }

    /* ========== ç«–å±æç¤º ========== */
    #portrait-tip {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      height: 100vh;
      background-color: #f7f7f7;
      color: #555;
      padding: 20px;
    }

    #portrait-tip img {
      width: 100px;
      height: 100px;
      opacity: 0.8;
      margin-bottom: 16px;
    }

    #portrait-tip h2 {
      color: #d32f2f;
      margin-bottom: 10px;
      font-size: 1.5em;
    }

    #portrait-tip p {
      font-size: 17px;
      line-height: 1.6;
    }
  </style>
</head>
<body>

  <!-- æ¨ªå±ï¼šè®¡åˆ†æ¿ -->
  <div id="landscape-mode">
    <h1>ğŸ² ä¸ƒè¿ç¿»è®¡åˆ†æ¿</h1>
    <table id="scoreTable">
      <thead>
        <tr id="headerRow"></tr>
      </thead>
      <tbody id="scoreBody"></tbody>
    </table>
    
    <!-- æŒ‰é’®é¡ºåºï¼šé«˜é¢‘ â†’ ä½é¢‘ -->
    <button class="action-btn add-row-btn" onclick="addScoreRow()">+ æ–°å¢ä¸€å±€</button>
    <button class="action-btn reset-btn" onclick="resetScores()">ğŸ” æ¸…ç©ºåˆ†æ•°ï¼Œä¿ç•™ç©å®¶</button>
    <button class="action-btn add-player-btn" onclick="addPlayer()">+ æ·»åŠ ç©å®¶</button>
  </div>

  <!-- ç«–å±ï¼šæç¤ºæ—‹è½¬ -->
  <div id="portrait-tip">
    <img src="https://cdn-icons-png.flaticon.com/512/184/184993.png" alt="è¯·æ—‹è½¬æ‰‹æœº">
    <h2>è¯·æ¨ªå±ä½¿ç”¨</h2>
    <p>æœ¬è®¡åˆ†æ¿ä¸ºæ¨ªå±ä¼˜åŒ–ï¼Œ<br>è¯·å°†æ‰‹æœºå‘å·¦æˆ–å‘å³æ—‹è½¬90Â°</p>
  </div>

  <script>
    const STORAGE_KEY = 'qilianfan_scores_simple';
    let gameData = {
      players: ['ç©å®¶1', 'ç©å®¶2'],
      scores: []
    };

    function loadFromStorage() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          const parsed = JSON.parse(saved);
          if (parsed.players && Array.isArray(parsed.players) && parsed.scores && Array.isArray(parsed.scores)) {
            gameData = parsed;
          }
        } catch (e) {
          console.warn('è§£æå¤±è´¥', e);
        }
      }
    }

    function saveToStorage() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(gameData));
    }

    function renderHeader() {
      const headerRow = document.getElementById('headerRow');
      headerRow.innerHTML = '<th>å±€æ•°</th>';
      gameData.players.forEach((name, index) => {
        const th = document.createElement('th');
        const input = document.createElement('input');
        input.type = 'text';
        input.value = name;
        input.className = 'player-name';
        input.dataset.index = index;
        input.addEventListener('change', function() {
          gameData.players[index] = this.value.trim() || `ç©å®¶${index + 1}`;
          saveToStorage();
          render();
        });
        th.appendChild(input);
        headerRow.appendChild(th);
      });
    }

    function renderScoreRows() {
      const tbody = document.getElementById('scoreBody');
      tbody.innerHTML = '';

      gameData.scores.forEach((row, rowIndex) => {
        const tr = document.createElement('tr');
        const roundTd = document.createElement('td');
        roundTd.textContent = `ç¬¬${rowIndex + 1}å±€`;
        tr.appendChild(roundTd);

        gameData.players.forEach((player, playerIndex) => {
          const td = document.createElement('td');
          const input = document.createElement('input');
          input.type = 'number';
          input.inputMode = 'numeric';
          input.value = row[playerIndex] !== undefined ? row[playerIndex] : '';
          input.dataset.row = rowIndex;
          input.dataset.col = playerIndex;
          input.addEventListener('change', function() {
            const rowIdx = parseInt(this.dataset.row);
            const colIdx = parseInt(this.dataset.col);
            const value = this.value.trim();
            gameData.scores[rowIdx][colIdx] = value ? parseInt(value) || 0 : 0;
            saveToStorage();
            updateTotalRow();
          });
          td.appendChild(input);
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });

      renderTotalRow();
    }

    function renderTotalRow() {
      const tbody = document.getElementById('scoreBody');
      const totalTr = document.createElement('tr');
      totalTr.className = 'total-row';

      const totalTd = document.createElement('td');
      totalTd.textContent = 'æ€»åˆ†';
      totalTr.appendChild(totalTd);

      gameData.players.forEach((player, playerIndex) => {
        const td = document.createElement('td');
        const total = gameData.scores.reduce((sum, row) => {
          const score = row[playerIndex];
          return sum + (score !== undefined ? score : 0);
        }, 0);
        td.textContent = total;
        totalTr.appendChild(td);
      });

      tbody.appendChild(totalTr);
    }

    function updateTotalRow() {
      const rows = document.getElementById('scoreBody').children;
      const totalTr = rows[rows.length - 1];
      gameData.players.forEach((player, playerIndex) => {
        const total = gameData.scores.reduce((sum, row) => {
          const score = row[playerIndex];
          return sum + (score !== undefined ? score : 0);
        }, 0);
        totalTr.children[playerIndex + 1].textContent = total;
      });
    }

    function addScoreRow() {
      const newRow = new Array(gameData.players.length).fill('');
      gameData.scores.push(newRow);
      saveToStorage();
      render();
    }

    function addPlayer() {
      const newPlayerName = `ç©å®¶${gameData.players.length + 1}`;
      gameData.players.push(newPlayerName);
      gameData.scores.forEach(row => row.push(''));
      saveToStorage();
      render();
    }

    // ä»…æ¸…ç©ºåˆ†æ•°å’Œå±€æ•°ï¼Œä¿ç•™ç©å®¶å
    function resetScores() {
      if (confirm('âš ï¸ ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰åˆ†æ•°å’Œå±€æ•°å—ï¼Ÿ\nç©å®¶å§“åå°†ä¿ç•™')) {
        gameData.scores = [];
        saveToStorage();
        addScoreRow();
        render();
      }
    }

    function render() {
      renderHeader();
      renderScoreRows();
    }

    // æ£€æµ‹æ–¹å‘
    function checkOrientation() {
      const isLandscape = window.innerWidth > window.innerHeight;
      document.getElementById('landscape-mode').style.display = isLandscape ? 'flex' : 'none';
      document.getElementById('portrait-tip').style.display = isLandscape ? 'none' : 'flex';
    }

    // åˆå§‹åŒ–
    window.addEventListener('load', () => {
      loadFromStorage();
      checkOrientation();
      render();
      if (gameData.scores.length === 0) {
        addScoreRow();
      }
    });

    // ç›‘å¬æ–¹å‘å˜åŒ–
    window.addEventListener('orientationchange', () => {
      setTimeout(checkOrientation, 300);
    });
    window.addEventListener('resize', checkOrientation);
  </script>
</body>
</html>